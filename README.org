#+title: Subscribe

* What it does?

If you manage mailing lists through [[https://www.mailgun.com/][mailgun.com]], =Subscribe= lets you
create webpages from where users can (un)subscribe (from)to your
mailing lists.

[[file:subscribe.png]]

* Features

- Filter displayed mailing list
- Receive an email very x subscription
- Use your own stylesheet based on [[https://bulma.io][bulma.io]]

* Configure

** Set up environment variables

Add this to your ~./profile~ file:

: export MAILGUN_API_KEY="your-key"
: export MAILGUN_LOGIN="postmaster@xxx"
: export MAILGUN_PASSWORD="your-password"
: export SUBSCRIBE_PORT=3000
: export SUBSCRIBE_BASEURL="http://yourdomain.com"

** Optionally define more options in ~resources/config.edn~

See ~resources/config.edn~:

: {;;;; Global configuration options:
:  ;;
:  ;; :locale               "gb-EN"                     ; or "fr-FR", etc.
:  ;; :db-uri               "datahike:mem:///subscribe" ; an URI to the local database
:  ;; :admin-email          "my@email.com"              ; a valid email address
:  ;; :css                  "/css/my-stylesheet.css"    ; absolute or relative stylesheet URL
:  ;; :lists-exclude-regexp nil                         ; a regular expression
:  ;; :lists-include-regexp nil                         ; a regular expression
:  ;; :ui-strings           {:mailing-lists "Title"}    ; custom UI strings
:  ;; :log-file             "log-filename.txt"          ; log file name
:  ;;
:  ;;;; Global options, possibly overriden by per-list options in :lists
:  ;;
:  ;; :from                 "postmaster@mydomain.org"
:  ;; :team                 "The name of my team"
:  ;; :tos-url              "http://localhost/tos"
:  ;; :smtp-host            ""
:  ;; :smtp-login           ""
:  ;; :smtp-password        ""
:  ;; :warn-every-x-subscribers 10
:  ;;
:  ;; :lists {"my-list@fqdn"
:  ;;         {:from          "Your Name <email@domain.com>"
:  ;;          :smtp-login    "email@domain.com"
:  ;;          :smtp-password "XXX"
:  ;;          :tos-url       "https://tos.com"}}
:  }

* Test

Run =lein test= to test the configuration before running the
application.

: ~$ git clone https://github.com/etalab/subscribe
: ~$ cd subscribe/
: ... [Set up your configuration]
: ~$ lein test

* Run

** With docker

Assuming your environments variables are stored in ~~/.subscribe_envs~
and you want to expose the 3000 port:

: ~$ git clone https://github.com/etalab/subscribe
: ~$ cd subscribe/
: ~$ docker build -t subscribe .
: ~$ docker run -it -p 3000:3000 --env-file=~/.subscribe_envs subscribe

Then go to http://localhost:3000.

** With ~lein run~

: ~$ git clone https://github.com/etalab/subscribe
: ~$ cd subscribe/
: ... [Set up your configuration]
: ~$ lein run

Then go to http://localhost:3000 or to your custom base URL.

** With =java -jar=

: ~$ git clone https://github.com/etalab/subscribe
: ~$ cd subscribe/
: ... [Set up your configuration]
: ~$ lein uberjar
: ~$ java -jar target/subscribe-x.x.x-standalone.jar

* TODOs

- [ ] Catch errors before redirecting to the confirmation pages
- [ ] Connect to other services than mailgun

* Support the Clojure ecosystem

If you like Clojure(script), please consider supporting maintainers by
donating to [[https://www.clojuriststogether.org][clojuriststogether.org]].

* License

=subscribe= is licensed under the [[http://www.eclipse.org/legal/epl-v10.html][Eclipse Public License 2.0]].
